---
description: Common issues and troubleshooting guide
---

# 常见问题与解决方案

## 问题1: 背景效果不显示（纯白页面）

### 原因
Tailwind JIT编译可能未包含动态生成的类名，或内联样式未正确应用。

### 解决方案
1. ✅ 使用内联`style`属性代替Tailwind类
2. ✅ 确保所有动画在`index.css`中定义
3. ✅ 检查`animation`属性是否正确应用

### 预防措施
对于复杂动画和动态样式，**始终使用内联样式**。

## 问题2: 粒子不断闪烁或移动

### 原因
在渲染时直接调用`Math.random()`，导致每次渲染都生成新的随机值。

### 解决方案
```typescript
// ❌ 错误 - 会导致闪烁
{[...Array(50)].map(() => {
  const randomX = Math.random() * 100; // 每次渲染都变！
  return <div style={{ left: `${randomX}%` }} />;
})}

// ✅ 正确 - 使用useMemo缓存
const particles = useMemo(() => 
  Array.from({length: 50}, () => ({
    x: Math.random() * 100 // 只计算一次
  }))
, []);
```

## 问题3: 沙漠呼吸有生硬的矩形边界

### 原因
使用div作为呼吸层，而不是SVG波浪形状。

### 解决方案
必须使用SVG path创建波浪形顶边：
```tsx
<svg viewBox="0 0 1440 400">
  <path d="M0,0 L0,400 ... C曲线命令 ... Z" />
</svg>
```

参考: [desert-breath.mdc](mdc:.cursor/rules/desert-breath.mdc)

## 问题4: 动画没有渐入渐出效果

### 原因
关键帧缺少开始和结束的opacity过渡。

### 解决方案
所有循环动画必须包含：
```css
@keyframes example {
  0%   { opacity: 0.05; } /* 渐入起点 */
  10%  { opacity: 0.4; }  /* 渐入完成 */
  /* ... */
  90%  { opacity: 0.3; }  /* 渐出开始 */
  100% { opacity: 0.05; } /* 渐出终点 */
}
```

## 问题5: 性能卡顿

### 诊断步骤
1. 打开Chrome DevTools → Performance
2. 录制5秒
3. 检查帧率是否低于60fps

### 常见原因和解决方案

#### 原因1: 未使用GPU加速
**解决**: 添加
```css
will-change: transform, opacity;
backface-visibility: hidden;
```

#### 原因2: 粒子数量过多
**解决**: 确保粒子总数≤150个

#### 原因3: 未使用useMemo缓存
**解决**: 参考 [performance-optimization.mdc](mdc:.cursor/rules/performance-optimization.mdc)

## 问题6: 光芒效果不移动

### 原因
光芒的`transform`属性缺少横向移动。

### 解决方案
光芒动画必须包含横向移动（-40% ↔ -60%）：
```css
@keyframes glow {
  0%   { transform: translate(-50%, 0) scale(0.85); }
  25%  { transform: translate(-40%, -10px) scale(1.15); } /* 右移 */
  50%  { transform: translate(-50%, -15px) scale(1.3); }
  75%  { transform: translate(-60%, -10px) scale(1.15); } /* 左移 */
  100% { transform: translate(-50%, 0) scale(0.85); }
}
```

## 问题7: Tailwind配置不生效

### 原因
PostCSS配置未使用正确的插件。

### 解决方案
确保 [postcss.config.js](mdc:postcss.config.js) 使用：
```javascript
export default {
  plugins: {
    '@tailwindcss/postcss': {}, // Tailwind v4
    autoprefixer: {},
  },
}
```

## 问题8: 颜色变化突兀

### 原因
沙漠呼吸动画的关键帧过少。

### 解决方案
至少使用12个关键帧平滑过渡：
0%, 5%, 15%, 20%, 25%, 35%, 40%, 45%, 55%, 60%, 65%, 75%, 80%, 85%, 95%, 100%

## 问题9: 主题切换后样式丢失

### 原因
依赖theme的样式使用了Tailwind类而非内联样式。

### 解决方案
所有依赖`theme`变量的样式必须使用内联`style`:
```typescript
style={{
  background: theme === 'dark' 
    ? '...' 
    : '...',
}}
```

## 问题10: Node.js版本警告

### 警告信息
```
You are using Node.js 20.18.0. 
Vite requires Node.js version 20.19+ or 22.12+.
```

### 解决方案
升级Node.js:
```bash
nvm install 20.19
nvm use 20.19
```

或使用Node 22:
```bash
nvm install 22
nvm use 22
```

## 快速检查清单

修改代码后，确保：
- [ ] 所有动画都在`index.css`中定义
- [ ] 复杂样式使用内联`style`
- [ ] 随机值通过`useMemo`缓存
- [ ] 所有动画元素有GPU加速属性
- [ ] 粒子总数≤150
- [ ] 循环动画有渐入渐出
- [ ] SVG使用波浪形路径（沙漠呼吸）
- [ ] 光芒有横向移动（20%范围）
